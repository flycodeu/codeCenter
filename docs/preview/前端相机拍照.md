---
title: å‰ç«¯ç›¸æœºæ‹ç…§
createTime: 2025/08/12 10:25:15
permalink: /article/bufjo2yk/
tags:
  - å‰ç«¯
cover: https://flycodeu-1314556962.cos.ap-nanjing.myqcloud.com/codeCenterImg/01d2325348cbc572d14b968324a1271b.jpg
---
# ç”¨åŸç”ŸWeb APIå®ç°ä¸“ä¸šçº§æ‹ç…§åŠŸèƒ½ï¼Œå‘Šåˆ«ä¼ ç»Ÿfile input

æœ€è¿‘é¡¹ç›®é‡Œç¢°åˆ°ä¸ªæœ‰æ„æ€çš„éœ€æ±‚ã€‚äº§å“ç»ç†æ‰¾åˆ°æˆ‘ï¼š"å’±ä»¬APPçš„èº«ä»½éªŒè¯é¡µé¢ï¼Œç”¨æˆ·åé¦ˆè¯´æ¯æ¬¡ä¸Šä¼ ç…§ç‰‡éƒ½è¦ä»ç›¸å†Œé‡Œç¿»åŠå¤©ï¼Œèƒ½ä¸èƒ½ç›´æ¥æ‹ç…§ä¸Šä¼ ï¼Ÿ"

æˆ‘å¿ƒæƒ³è¿™ä¸ç®€å•å—ï¼Œæ”¹ä¸ª`<input type="file" accept="image/*" capture="camera">`ä¸å°±å®Œäº†ï¼Ÿ

ç»“æœäº§å“è¡¥å……é“ï¼š"æœ€å¥½èƒ½åˆ‡æ¢å‰åæ‘„åƒå¤´ï¼Œæ‹å®Œèƒ½é¢„è§ˆé‡æ‹ï¼Œä½“éªŒè¦å’ŒåŸç”ŸAPPä¸€æ ·æµç•…ã€‚"

## å®ç°æ•ˆæœ

å…ˆçœ‹çœ‹æœ€ç»ˆæ•ˆæœï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š
- ç›´æ¥è°ƒç”¨æ‰‹æœºæ‘„åƒå¤´ï¼ˆä¸æ˜¯é€‰æ‹©ç›¸å†Œå›¾ç‰‡ï¼‰
- å‰åæ‘„åƒå¤´åˆ‡æ¢
- æ‹ç…§åé¢„è§ˆ
- é‡æ‹æˆ–ä¿å­˜
- å®Œå…¨é€‚é…ç§»åŠ¨ç«¯

![image-20250812103414848](https://flycodeu-1314556962.cos.ap-nanjing.myqcloud.com/codeCenterImg/image-20250812103414848.png)

## æŠ€æœ¯åŸç†è¯¦è§£

### 1. getUserMedia - Webæ‘„åƒå¤´çš„å…¥åœºåˆ¸

æ•´ä¸ªåŠŸèƒ½çš„åŸºç¡€æ˜¯`navigator.mediaDevices.getUserMedia()`è¿™ä¸ªAPIã€‚ç¬¬ä¸€æ¬¡æ¥è§¦çš„æœ‹å‹å¯èƒ½ä¼šè¢«è¿™ä¸ªé•¿åå­—å“åˆ°ï¼Œå…¶å®ç†è§£èµ·æ¥å¾ˆç®€å•ï¼š

```javascript
// å‘Šè¯‰æµè§ˆå™¨ï¼šæˆ‘è¦ç”¨æ‘„åƒå¤´äº†
const constraints = {
    video: {
        facingMode: { ideal: 'environment' }, // åç½®æ‘„åƒå¤´
        width: { ideal: 1920 },
        height: { ideal: 1080 }
    },
    audio: false  // åªè¦è§†é¢‘ï¼Œä¸è¦éŸ³é¢‘
};

try {
    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    // streamå°±æ˜¯æ‘„åƒå¤´çš„æ•°æ®æµ
} catch(error) {
    console.log('ç”¨æˆ·æ‹’ç»äº†æ‘„åƒå¤´æƒé™');
}
```

è¿™é‡Œæœ‰ä¸ªå‘è¦æ³¨æ„ï¼š`facingMode`è¿™ä¸ªå‚æ•°åœ¨PCä¸Šæ˜¯æ— æ•ˆçš„ï¼ˆå› ä¸ºç”µè„‘æ‘„åƒå¤´ä¸åˆ†å‰åï¼‰ï¼Œä½†åœ¨æ‰‹æœºä¸Šå¾ˆé‡è¦ï¼š
- `environment` = åç½®æ‘„åƒå¤´ï¼ˆæ‹é£æ™¯ï¼‰
- `user` = å‰ç½®æ‘„åƒå¤´ï¼ˆè‡ªæ‹ï¼‰

### 2. æŠŠæ‘„åƒå¤´ç”»é¢æ˜¾ç¤ºå‡ºæ¥

æ‹¿åˆ°streamåï¼Œéœ€è¦è®©ç”¨æˆ·çœ‹åˆ°æ‘„åƒå¤´ç”»é¢ã€‚è¿™é‡Œç”¨åˆ°HTML5çš„`<video>`æ ‡ç­¾ï¼š

```javascript
const video = document.getElementById('video');
video.srcObject = stream;  // å°±è¿™ä¹ˆç®€å•ï¼
```

ä½†æ˜¯ï¼è¿™é‡Œæœ‰ä¸ªç»†èŠ‚å¾ˆå¤šäººä¼šå¿½ç•¥ï¼švideoæ ‡ç­¾éœ€è¦åŠ ä¸Š`autoplay`ã€`muted`å’Œ`playsinline`å±æ€§ï¼š

```html
<video id="video" autoplay muted playsinline></video>
```

ä¸ºå•¥è¦è¿™äº›å±æ€§ï¼Ÿ
- `autoplay`ï¼šè‡ªåŠ¨æ’­æ”¾ï¼ˆåºŸè¯ï¼‰
- `muted`ï¼šé™éŸ³ï¼Œä¸ç„¶æŸäº›æµè§ˆå™¨ä¸è®©è‡ªåŠ¨æ’­æ”¾
- `playsinline`ï¼šåœ¨iOS Safariä¸Šé˜²æ­¢å…¨å±æ’­æ”¾

### 3. æ‹ç…§çš„æ ¸å¿ƒ - Canvasæˆªå›¾å¤§æ³•

è¿™éƒ¨åˆ†æ˜¯æ•´ä¸ªåŠŸèƒ½æœ€æœ‰æŠ€æœ¯å«é‡çš„åœ°æ–¹ã€‚åŸç†æ˜¯æŠŠvideoçš„å½“å‰ç”»é¢"ç”»"åˆ°canvasä¸Šï¼š

```javascript
function capturePhoto() {
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    
    // å…³é”®ï¼šcanvaså°ºå¯¸è¦è®¾ç½®ä¸ºè§†é¢‘çš„çœŸå®å°ºå¯¸
    canvas.width = video.videoWidth;   // æ³¨æ„æ˜¯videoWidthä¸æ˜¯width
    canvas.height = video.videoHeight;
    
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0);
    
    // è·å–å›¾ç‰‡æ•°æ®
    const imageData = canvas.toDataURL('image/jpeg', 0.9);
}
```

ä½†ç­‰ç­‰ï¼å¦‚æœä½ ç”¨å‰ç½®æ‘„åƒå¤´è‡ªæ‹ï¼Œä¼šå‘ç°ç…§ç‰‡æ˜¯é•œåƒçš„ï¼ˆå·¦å³åäº†ï¼‰ã€‚è¿™æ˜¯å› ä¸ºå‰ç½®æ‘„åƒå¤´é»˜è®¤å°±æ˜¯é•œåƒæ˜¾ç¤ºçš„ï¼Œä½†æ‹ç…§æ—¶æˆ‘ä»¬éœ€è¦ç¿»è½¬å›æ¥ï¼š

```javascript
if (currentFacingMode === 'user') {
    // æ°´å¹³ç¿»è½¬canvas
    ctx.scale(-1, 1);
    ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
} else {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
}
```

è¿™ä¸ªç¿»è½¬é€»è¾‘å›°æ‰°äº†æˆ‘å¥½ä¹…ï¼ŒStack Overflowä¸Šå„ç§è¯´æ³•éƒ½æœ‰ï¼Œæœ€åè¿˜æ˜¯è‡ªå·±è¯•å‡ºæ¥çš„ã€‚

### 4. æ‘„åƒå¤´åˆ‡æ¢çš„æ­£ç¡®å§¿åŠ¿

åˆ‡æ¢æ‘„åƒå¤´ä¸æ˜¯ç®€å•åœ°æ”¹ä¸ªå‚æ•°å°±è¡Œï¼Œéœ€è¦å…ˆåœæ‰å½“å‰çš„æµï¼Œå†é‡æ–°ç”³è¯·ï¼š

```javascript
async function flipCamera() {
    // æ­¥éª¤1ï¼šåœæ‰å½“å‰æ‘„åƒå¤´
    if (stream) {
        stream.getTracks().forEach(track => track.stop());
    }
    
    // æ­¥éª¤2ï¼šåˆ‡æ¢æ‘„åƒå¤´ç±»å‹
    const newMode = currentFacingMode === 'environment' ? 'user' : 'environment';
    
    // æ­¥éª¤3ï¼šé‡æ–°ç”³è¯·æƒé™
    const constraints = {
        video: { facingMode: { ideal: newMode } }
    };
    
    const newStream = await navigator.mediaDevices.getUserMedia(constraints);
    video.srcObject = newStream;
}
```

## è¸©è¿‡çš„å‘å’Œè§£å†³æ–¹æ¡ˆ

### å‘1ï¼šiOSä¸Šæ‘„åƒå¤´å¯åŠ¨å¤±è´¥

iOS Safariå¯¹æ‘„åƒå¤´æƒé™ç‰¹åˆ«ä¸¥æ ¼ï¼Œå¿…é¡»æ˜¯ç”¨æˆ·ä¸»åŠ¨è§¦å‘ï¼ˆæ¯”å¦‚ç‚¹å‡»æŒ‰é’®ï¼‰æ‰èƒ½ç”³è¯·æƒé™ã€‚æ‰€ä»¥æˆ‘åšäº†ä¸ª"æ‰“å¼€ç›¸æœº"æŒ‰é’®ï¼Œè€Œä¸æ˜¯é¡µé¢åŠ è½½å°±è‡ªåŠ¨å¯åŠ¨ã€‚

### å‘2ï¼šä¸åŒæ‰‹æœºæ‘„åƒå¤´åç§°ä¸ä¸€æ ·

æœ‰äº›Androidæ‰‹æœºçš„å‰ç½®æ‘„åƒå¤´å«"front"ï¼Œåç½®å«"back"ã€‚æ‰€ä»¥ç”¨`ideal`è€Œä¸æ˜¯`exact`ï¼š

```javascript
facingMode: { ideal: 'environment' }  // ä¼˜å…ˆä½¿ç”¨ï¼Œæ²¡æœ‰å°±é™çº§
// è€Œä¸æ˜¯
facingMode: { exact: 'environment' }  // å¿…é¡»ä½¿ç”¨ï¼Œæ²¡æœ‰å°±æŠ¥é”™
```

### å‘3ï¼šåˆ‡æ¢é¡µé¢åæ‘„åƒå¤´è¿˜åœ¨è¿è¡Œ

ç”¨æˆ·åˆ‡åˆ°å¾®ä¿¡å›æ¶ˆæ¯ï¼Œæ‘„åƒå¤´è¿˜åœ¨å·å·è¿è¡Œï¼Œç‰¹åˆ«è´¹ç”µã€‚è§£å†³æ–¹æ³•ï¼š

```javascript
document.addEventListener('visibilitychange', function() {
    if (document.hidden && stream) {
        // é¡µé¢éšè—æ—¶å…³é—­æ‘„åƒå¤´
        stream.getTracks().forEach(track => track.stop());
    }
});
```

## æ€§èƒ½ä¼˜åŒ–æŠ€å·§

### 1. åˆç†çš„å›¾ç‰‡è´¨é‡

```javascript
canvas.toDataURL('image/jpeg', 0.9);  // 0.9æ˜¯ä¸ªå¥½çš„å¹³è¡¡ç‚¹
```

æˆ‘æµ‹è¯•äº†ä¸åŒè´¨é‡å‚æ•°ï¼š
- 1.0ï¼šæ–‡ä»¶å¤ªå¤§ï¼ˆ2-3MBï¼‰ï¼Œä¸Šä¼ æ…¢
- 0.9ï¼šå‡ ä¹çœ‹ä¸å‡ºå·®åˆ«ï¼Œæ–‡ä»¶å°ä¸€åŠ
- 0.7ï¼šå¼€å§‹æœ‰æ˜æ˜¾å‹ç¼©ç—•è¿¹

### 2. åŠæ—¶é‡Šæ”¾èµ„æº

æ‘„åƒå¤´æ˜¯å¾ˆè€—ç”µçš„ï¼Œç”¨å®Œè®°å¾—å…³ï¼š

```javascript
function closeCamera() {
    if (stream) {
        stream.getTracks().forEach(track => {
            track.stop();  // å…³é—­æ¯ä¸ªè½¨é“
        });
        stream = null;
        video.srcObject = null;  // æ¸…ç©ºvideo
    }
}
```

### 3. é™çº§å¤„ç†

ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒæ‘„åƒå¤´APIï¼Œè¦åšå¥½é™çº§ï¼š

```javascript
if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
    // é™çº§åˆ°ä¼ ç»Ÿçš„file input
    alert('ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´ï¼Œè¯·é€‰æ‹©å›¾ç‰‡ä¸Šä¼ ');
    showFileInput();
    return;
}
```

## UIè®¾è®¡

### æ‹ç…§æŒ‰é’®çš„è®¾è®¡

æ¨¡ä»¿äº†éƒ¨åˆ†ç›¸æœºçš„è®¾è®¡ï¼ŒåŒå±‚åœ†åœˆï¼š

```css
.capture-btn {
    width: 70px;
    height: 70px;
    border: 4px solid #fff;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
}

.capture-btn::after {
    content: '';
    width: 50px;
    height: 50px;
    background: #fff;
    border-radius: 50%;
}
```

### åº•éƒ¨æ§åˆ¶æ çš„æ¸å˜é®ç½©

```css
.camera-controls {
    background: linear-gradient(transparent, rgba(0,0,0,0.8));
}
```

è¿™ä¸ªæ¸å˜è®©æŒ‰é’®æ›´çªå‡ºï¼Œè€Œä¸”çœ‹èµ·æ¥æ›´ä¸“ä¸šã€‚

## å®Œæ•´ä»£ç ç¤ºä¾‹

### HTMLç»“æ„

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹æœºç›¸æœºæ‹ç…§</title>
</head>
<body>
    <div class="camera-container">
        <!-- æ¬¢è¿å±å¹• -->
        <div class="welcome-screen" id="welcomeScreen">
            <h1>ğŸ“¸ ç›¸æœºæ‹ç…§</h1>
            <button class="open-camera-btn" onclick="openCamera()">æ‰“å¼€ç›¸æœº</button>
        </div>

        <!-- ç›¸æœºè§†å›¾ -->
        <div class="camera-view" id="cameraView">
            <video id="video" autoplay muted playsinline></video>
            <button class="close-btn" onclick="closeCamera()">Ã—</button>
            <button class="flip-btn" onclick="flipCamera()">ğŸ”„</button>
            <div class="camera-controls">
                <div class="capture-btn" onclick="capturePhoto()"></div>
            </div>
        </div>

        <!-- é¢„è§ˆå±å¹• -->
        <div class="preview-screen" id="previewScreen">
            <img id="preview" alt="æ‹ç…§é¢„è§ˆ">
            <div class="preview-controls">
                <button class="control-btn retake" onclick="retakePhoto()">é‡æ–°æ‹ç…§</button>
                <button class="control-btn submit" onclick="submitPhoto()">æäº¤ç…§ç‰‡</button>
            </div>
        </div>

        <!-- éšè—çš„canvasç”¨äºå›¾ç‰‡å¤„ç† -->
        <canvas id="canvas"></canvas>
    </div>
</body>
</html>
```

### æ ¸å¿ƒJavaScriptä»£ç 

```javascript
let stream = null;
let capturedImageData = null;
let currentFacingMode = 'environment';

// æ‰“å¼€ç›¸æœº
async function openCamera(facingMode = currentFacingMode) {
    try {
        // å¦‚æœå·²æœ‰æµï¼Œå…ˆåœæ­¢
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
        }
        
        // è¯·æ±‚ç›¸æœºæƒé™
        const constraints = {
            video: {
                facingMode: { ideal: facingMode },
                width: { ideal: 1920 },
                height: { ideal: 1080 }
            },
            audio: false
        };

        stream = await navigator.mediaDevices.getUserMedia(constraints);
        currentFacingMode = facingMode;
        
        const video = document.getElementById('video');
        video.srcObject = stream;
        
        // æ˜¾ç¤ºç›¸æœºç•Œé¢
        document.getElementById('welcomeScreen').style.display = 'none';
        document.getElementById('cameraView').style.display = 'block';

    } catch (error) {
        console.error('ç›¸æœºå¯åŠ¨å¤±è´¥:', error);
        handleCameraError(error);
    }
}

// æ‹ç…§
function capturePhoto() {
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const preview = document.getElementById('preview');
    
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    
    const ctx = canvas.getContext('2d');
    
    // å‰ç½®æ‘„åƒå¤´éœ€è¦æ°´å¹³ç¿»è½¬
    if (currentFacingMode === 'user') {
        ctx.scale(-1, 1);
        ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
    } else {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    }
    
    // è·å–å›¾ç‰‡æ•°æ®
    capturedImageData = canvas.toDataURL('image/jpeg', 0.9);
    
    // æ˜¾ç¤ºé¢„è§ˆ
    preview.src = capturedImageData;
    document.getElementById('cameraView').style.display = 'none';
    document.getElementById('previewScreen').style.display = 'block';
}

// é”™è¯¯å¤„ç†
function handleCameraError(error) {
    let errorMessage = 'ç›¸æœºå¯åŠ¨å¤±è´¥';
    
    if (error.name === 'NotAllowedError') {
        errorMessage = 'è¯·å…è®¸è®¿é—®ç›¸æœºæƒé™';
    } else if (error.name === 'NotFoundError') {
        errorMessage = 'æœªæ‰¾åˆ°ç›¸æœºè®¾å¤‡';
    } else if (error.name === 'NotSupportedError') {
        errorMessage = 'æµè§ˆå™¨ä¸æ”¯æŒç›¸æœºåŠŸèƒ½';
    }
    
    alert(errorMessage);
}
```

## å…¼å®¹æ€§è¯´æ˜

| æµè§ˆå™¨ | æœ€ä½ç‰ˆæœ¬ | æ”¯æŒæƒ…å†µ |
|--------|----------|----------|
| iOS Safari | 11+ | âœ… å®Œå…¨æ”¯æŒ |
| Android Chrome | 53+ | âœ… å®Œå…¨æ”¯æŒ |
| å¾®ä¿¡å†…ç½®æµè§ˆå™¨ | - | âš ï¸ éƒ¨åˆ†æœºå‹å¯èƒ½æœ‰é—®é¢˜ |
| PC Chrome | 53+ | âœ… æ”¯æŒï¼ˆæ— æ³•åˆ‡æ¢æ‘„åƒå¤´ï¼‰ |
| PC Firefox | 36+ | âœ… æ”¯æŒï¼ˆæ— æ³•åˆ‡æ¢æ‘„åƒå¤´ï¼‰ |

## æ³¨æ„äº‹é¡¹

1. **HTTPSè¦æ±‚**ï¼šå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæ‘„åƒå¤´APIåªèƒ½åœ¨HTTPSç¯å¢ƒä¸‹ä½¿ç”¨ã€‚æœ¬åœ°å¼€å‘æ—¶å¯ä»¥ç”¨`localhost`
2. **æƒé™ç”³è¯·**ï¼šé¦–æ¬¡ä½¿ç”¨ä¼šå¼¹å‡ºæƒé™ç”³è¯·ï¼Œç”¨æˆ·æ‹’ç»åéœ€è¦æ‰‹åŠ¨åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å¼€å¯
3. **æ€§èƒ½è€ƒè™‘**ï¼šé•¿æ—¶é—´å¼€å¯æ‘„åƒå¤´ä¼šè€—ç”µï¼Œè®°å¾—åŠæ—¶å…³é—­
4. **éšç§ä¿æŠ¤**ï¼šåœ¨æ˜¾çœ¼ä½ç½®æç¤ºç”¨æˆ·æ­£åœ¨ä½¿ç”¨æ‘„åƒå¤´

## éƒ¨ç½²
### Serveå·¥å…·
é€šè¿‡Node.jså¿«é€Ÿå¯åŠ¨ä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œä¸ºå½“å‰ç›®å½•æä¾›ä¸€ä¸ªè®¿é—®è·¯å¾„ã€‚ é¦–å…ˆéœ€è¦å®‰è£…serve
```js
npm i -g serve
```
ç„¶ååœ¨å½“å‰ç›®å½•ä¸‹è¿è¡Œ
```js
serve index.html
```
![image-20250812102921193](https://flycodeu-1314556962.cos.ap-nanjing.myqcloud.com/codeCenterImg/image-20250812102921193.png)

ä½†æ˜¯ç›®å‰åªèƒ½åœ¨localhostæœ¬åœ°è®¿é—®ï¼Œhttpæ ¼å¼çš„é“¾æ¥æ˜¯æ— æ³•è·å–å¯¹åº”çš„æƒé™ï¼Œ

### ngrokå®ç°å†…ç½‘ç©¿é€

è¯¦ç»†å®‰è£…æ­¥éª¤å¯ä»¥å‚è€ƒ [å®‰è£…ngrok](https://blog.csdn.net/Myon5/article/details/134626288)

![image-20250812103212633](https://flycodeu-1314556962.cos.ap-nanjing.myqcloud.com/codeCenterImg/image-20250812103212633.png)

æœ€ç»ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªé“¾æ¥è®¿é—®ã€‚

## å®Œæ•´ä»£ç 
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹æœºç›¸æœºæ‹ç…§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
            user-select: none;
        }

        .camera-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .welcome-screen {
            text-align: center;
            padding: 20px;
        }

        .welcome-screen h1 {
            font-size: 24px;
            margin-bottom: 30px;
            color: #fff;
        }

        .open-camera-btn {
            background: linear-gradient(45deg, #007AFF, #5856D6);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);
        }

        .open-camera-btn:hover {
            transform: translateY(-2px);
        }

        .camera-view {
            display: none;
            width: 100%;
            height: 100%;
            position: relative;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 30px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
        }

        .capture-btn {
            width: 70px;
            height: 70px;
            border: 4px solid #fff;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .capture-btn:hover {
            background: rgba(255,255,255,0.4);
            transform: scale(1.05);
        }

        .capture-btn::after {
            content: '';
            width: 50px;
            height: 50px;
            background: #fff;
            border-radius: 50%;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .flip-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
        }

        .flip-btn:hover {
            transform: rotateY(180deg);
        }

        .preview-screen {
            display: none;
            width: 100%;
            height: 100%;
            position: relative;
        }

        #preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 30px 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .control-btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .control-btn.retake {
            background: #666;
        }

        .control-btn.retake:hover {
            background: #555;
        }

        .control-btn.submit {
            background: #34C759;
        }

        .control-btn.submit:hover {
            background: #28a745;
        }

        #canvas {
            display: none;
        }

        .status-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        @media (max-width: 480px) {
            .camera-controls {
                padding: 20px;
                gap: 20px;
            }
            
            .capture-btn {
                width: 60px;
                height: 60px;
            }
            
            .capture-btn::after {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="camera-container">
        <!-- æ¬¢è¿å±å¹• -->
        <div class="welcome-screen" id="welcomeScreen">
            <h1>ğŸ“¸ ç›¸æœºæ‹ç…§</h1>
            <button class="open-camera-btn" onclick="openCamera()">æ‰“å¼€ç›¸æœº</button>
        </div>

        <!-- ç›¸æœºè§†å›¾ -->
        <div class="camera-view" id="cameraView">
            <video id="video" autoplay muted playsinline></video>
            <button class="close-btn" onclick="closeCamera()">Ã—</button>
            <button class="flip-btn" onclick="flipCamera()" title="åˆ‡æ¢æ‘„åƒå¤´">ğŸ”„</button>
            <div class="camera-controls">
                <div class="capture-btn" onclick="capturePhoto()"></div>
            </div>
        </div>

        <!-- é¢„è§ˆå±å¹• -->
        <div class="preview-screen" id="previewScreen">
            <img id="preview" alt="æ‹ç…§é¢„è§ˆ">
            <div class="preview-controls">
                <button class="control-btn retake" onclick="retakePhoto()">é‡æ–°æ‹ç…§</button>
                <button class="control-btn submit" onclick="submitPhoto()">æäº¤ç…§ç‰‡</button>
            </div>
        </div>

        <!-- éšè—çš„canvasç”¨äºå›¾ç‰‡å¤„ç† -->
        <canvas id="canvas"></canvas>

        <!-- çŠ¶æ€æ¶ˆæ¯ -->
        <div class="status-message" id="statusMessage"></div>
    </div>

    <script>
        let stream = null;
        let capturedImageData = null;
        let currentFacingMode = 'environment'; // 'environment' ä¸ºåç½®ï¼Œ'user' ä¸ºå‰ç½®

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, duration = 2000) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.style.display = 'block';
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, duration);
        }

        // æ‰“å¼€ç›¸æœº
        async function openCamera(facingMode = currentFacingMode) {
            try {
                showStatus('æ­£åœ¨å¯åŠ¨ç›¸æœº...');
                
                // å¦‚æœå·²æœ‰æµï¼Œå…ˆåœæ­¢
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }
                
                // è¯·æ±‚ç›¸æœºæƒé™
                const constraints = {
                    video: {
                        facingMode: { ideal: facingMode },
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    },
                    audio: false
                };

                stream = await navigator.mediaDevices.getUserMedia(constraints);
                currentFacingMode = facingMode;
                
                const video = document.getElementById('video');
                video.srcObject = stream;
                
                // ç­‰å¾…è§†é¢‘åŠ è½½
                video.onloadedmetadata = () => {
                    document.getElementById('welcomeScreen').style.display = 'none';
                    document.getElementById('cameraView').style.display = 'block';
                    
                    const cameraType = facingMode === 'environment' ? 'åç½®' : 'å‰ç½®';
                    showStatus(`${cameraType}ç›¸æœºå·²å¯åŠ¨ï¼Œç‚¹å‡»æ‹ç…§æŒ‰é’®è¿›è¡Œæ‹ç…§`);
                };

            } catch (error) {
                console.error('ç›¸æœºå¯åŠ¨å¤±è´¥:', error);
                let errorMessage = 'ç›¸æœºå¯åŠ¨å¤±è´¥';
                
                if (error.name === 'NotAllowedError') {
                    errorMessage = 'è¯·å…è®¸è®¿é—®ç›¸æœºæƒé™';
                } else if (error.name === 'NotFoundError') {
                    errorMessage = 'æœªæ‰¾åˆ°ç›¸æœºè®¾å¤‡';
                } else if (error.name === 'NotSupportedError') {
                    errorMessage = 'æµè§ˆå™¨ä¸æ”¯æŒç›¸æœºåŠŸèƒ½';
                } else if (error.name === 'OverconstrainedError') {
                    // å¦‚æœæŒ‡å®šçš„æ‘„åƒå¤´ä¸å¯ç”¨ï¼Œå°è¯•ä½¿ç”¨å¦ä¸€ä¸ª
                    const fallbackMode = facingMode === 'environment' ? 'user' : 'environment';
                    showStatus('åˆ‡æ¢åˆ°å¯ç”¨çš„æ‘„åƒå¤´...');
                    await openCamera(fallbackMode);
                    return;
                }
                
                showStatus(errorMessage, 3000);
            }
        }

        // åˆ‡æ¢æ‘„åƒå¤´
        async function flipCamera() {
            if (!stream) return;
            
            const newFacingMode = currentFacingMode === 'environment' ? 'user' : 'environment';
            const cameraType = newFacingMode === 'environment' ? 'åç½®' : 'å‰ç½®';
            
            showStatus(`æ­£åœ¨åˆ‡æ¢åˆ°${cameraType}æ‘„åƒå¤´...`);
            
            try {
                await openCamera(newFacingMode);
            } catch (error) {
                showStatus('æ‘„åƒå¤´åˆ‡æ¢å¤±è´¥ï¼Œè¯·é‡è¯•');
                console.error('æ‘„åƒå¤´åˆ‡æ¢å¤±è´¥:', error);
            }
        }

        // å…³é—­ç›¸æœº
        function closeCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            document.getElementById('cameraView').style.display = 'none';
            document.getElementById('previewScreen').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = 'block';
        }

        // æ‹ç…§
        function capturePhoto() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const preview = document.getElementById('preview');
            
            // è®¾ç½®canvaså°ºå¯¸ä¸ºè§†é¢‘å°ºå¯¸
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // å°†è§†é¢‘å¸§ç»˜åˆ¶åˆ°canvas
            const ctx = canvas.getContext('2d');
            
            // å¦‚æœæ˜¯å‰ç½®æ‘„åƒå¤´ï¼Œéœ€è¦æ°´å¹³ç¿»è½¬å›¾åƒ
            if (currentFacingMode === 'user') {
                ctx.scale(-1, 1);
                ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
            } else {
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            }
            
            // è·å–å›¾ç‰‡æ•°æ®
            capturedImageData = canvas.toDataURL('image/jpeg', 0.9);
            
            // æ˜¾ç¤ºé¢„è§ˆ
            preview.src = capturedImageData;
            document.getElementById('cameraView').style.display = 'none';
            document.getElementById('previewScreen').style.display = 'block';
            
            showStatus('ç…§ç‰‡æ‹æ‘„æˆåŠŸï¼');
        }

        // é‡æ–°æ‹ç…§
        function retakePhoto() {
            document.getElementById('previewScreen').style.display = 'none';
            document.getElementById('cameraView').style.display = 'block';
            capturedImageData = null;
        }

        // æäº¤ç…§ç‰‡ï¼ˆæ¨¡æ‹Ÿä¸‹è½½åˆ°æœ¬åœ°ï¼‰
        function submitPhoto() {
            if (!capturedImageData) {
                showStatus('æ²¡æœ‰å¯æäº¤çš„ç…§ç‰‡');
                return;
            }

            try {
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const link = document.createElement('a');
                const cameraType = currentFacingMode === 'environment' ? 'rear' : 'front';
                link.download = `photo_${cameraType}_${new Date().getTime()}.jpg`;
                link.href = capturedImageData;
                
                // è§¦å‘ä¸‹è½½
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showStatus('ç…§ç‰‡å·²ä¸‹è½½åˆ°æœ¬åœ°ï¼');
                
                // è¿”å›æ¬¢è¿ç•Œé¢
                setTimeout(() => {
                    closeCamera();
                }, 1500);
                
            } catch (error) {
                console.error('ä¸‹è½½å¤±è´¥:', error);
                showStatus('ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
        window.onload = function() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showStatus('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒç›¸æœºåŠŸèƒ½', 5000);
                document.querySelector('.open-camera-btn').disabled = true;
            }
        };

        // å¤„ç†é¡µé¢éšè—æ—¶å…³é—­ç›¸æœº
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && stream) {
                closeCamera();
            }
        });
    </script>
</body>
</html>
```

## æ€»ç»“

è¿™ä¸ªåŠŸèƒ½çœ‹èµ·æ¥ç®€å•ï¼Œå®é™…ä¸Šæ¶‰åŠçš„ç»†èŠ‚è¿˜æŒºå¤šã€‚ç‰¹åˆ«æ˜¯å„ç§è¾¹ç•Œæƒ…å†µçš„å¤„ç†ï¼Œæ¯”å¦‚æƒé™è¢«æ‹’ç»ã€æ‘„åƒå¤´è¢«å ç”¨ã€é¡µé¢åˆ‡æ¢ç­‰ç­‰ã€‚

æœ€è®©æˆ‘æ„å¤–çš„æ˜¯ï¼ŒåŸç”ŸWeb APIå·²ç»è¿™ä¹ˆå¼ºå¤§äº†ï¼Œå®Œå…¨å¯ä»¥åšå‡ºä¸è¾“åŸç”ŸAPPçš„ä½“éªŒã€‚å½“ç„¶ï¼Œå¦‚æœä½ çš„éœ€æ±‚æ›´å¤æ‚ï¼ˆæ¯”å¦‚ç¾é¢œã€æ»¤é•œï¼‰ï¼Œå¯èƒ½è¿˜æ˜¯å¾—ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹åº“ã€‚

å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ã€‚å¦‚æœä½ åœ¨å®ç°è¿‡ç¨‹ä¸­é‡åˆ°å…¶ä»–å‘ï¼Œæ¬¢è¿ç•™è¨€äº¤æµï¼

---

*PS: æµ‹è¯•çš„æ—¶å€™è®°å¾—ç”¨HTTPSï¼ŒHTTPä¸‹æµè§ˆå™¨ä¸ç»™æ‘„åƒå¤´æƒé™ã€‚æœ¬åœ°å¼€å‘å¯ä»¥ç”¨localhostï¼Œå®ƒè¢«ç‰¹æ®Šå¯¹å¾…äº†ã€‚*